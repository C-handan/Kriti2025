<!DOCTYPE html>
 <html lang="en">
 

 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConnectSphere</title>
  <style>
   body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #B5FFE1;
    color: #00241B;
    line-height: 1.6;
   }
 

   /* Header */
   #header {
    background-color: #00241B;
    color: #B5FFE1;
    padding: 20px 0;
    text-align: center;
   }
 

   #header h1 {
    margin: 0;
    font-size: 2em;
   }
 

   /* Profile Section */
   #profile-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    background-color: #93E5AB;
    border-radius: 10px;
    margin: 20px auto;
    width: 80%;
    max-width: 600px;
    display: none;
   }
 

   #profile-image {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 5px solid #B5FFE1;
    cursor: pointer;
   }
 

   #profile-name {
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 5px;
    color: #00241B;
   }
 

   #profile-bio {
    font-size: 1em;
    color: #00241B;
    text-align: center;
    margin-bottom: 15px;
   }
 

   /* Create Profile Modal */
   #create-profile-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 11;
   }
 

   #create-profile-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #B5FFE1;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: 80%;
    max-width: 500px;
   }
 

   #create-profile-modal input[type="text"],
   #create-profile-modal input[type="file"],
   #create-profile-modal textarea {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #65B891;
    width: 100%;
    box-sizing: border-box;
   }
 

   #create-profile-modal button {
    background-color: #00241B;
    color: #B5FFE1;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 10px;
   }
 

   #create-profile-modal button:hover {
    background-color: #4E878C;
   }
 

   /* Edit Profile Modal */
   #edit-profile-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 10;
   }
 

   #edit-profile-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #B5FFE1;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: 80%;
    max-width: 500px;
   }
 

   #edit-profile-modal input[type="text"],
   #edit-profile-modal input[type="file"],
   #edit-profile-modal textarea {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #65B891;
    width: 100%;
    box-sizing: border-box;
   }
 

   #edit-profile-modal button {
    background-color: #00241B;
    color: #B5FFE1;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 10px;
   }
 

   #edit-profile-modal button:hover {
    background-color: #4E878C;
   }
 

   #close-edit-modal,
   #close-create-modal {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.2em;
    cursor: pointer;
    color: #00241B;
   }
 

   /* Post Form */
   #post-form {
    width: 80%;
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    background-color: #93E5AB;
    border-radius: 10px;
   }
 

   #post-form textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #65B891;
    border-radius: 5px;
    resize: vertical;
   }
 

   #post-form input[type="file"] {
    margin-bottom: 10px;
   }
 

   #post-form button {
    background-color: #00241B;
    color: #B5FFE1;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
   }
 

   #post-form button:hover {
    background-color: #4E878C;
   }
 

   /* Posts Section */
   #posts-section {
    width: 80%;
    max-width: 600px;
    margin: 20px auto;
    display: none;
   }
 

   .post {
    background-color: #93E5AB;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    position: relative;
   }
 

   .post-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
   }
 

   .post-author-image {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 10px;
   }
 

   .post-content {
    color: #00241B;
    margin-bottom: 10px;
   }
 

   .post img {
    max-width: 100%;
    height: auto;
    margin-bottom: 10px;
    border-radius: 5px;
   }
 

   .post-interactions {
    margin-top: 10px;
    display: flex;
    justify-content: space-around;
    align-items: center;
   }
 

   .like-button,
   .comment-button {
    background-color: #00241B;
    color: #B5FFE1;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
   }
 

   .like-button:hover {
    background-color: #4E878C;
   }
 

   .liked {
    background-color: #4E878C;
   }
 

   /* All Users Section */
   #all-users-section {
    width: 80%;
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background-color: #93E5AB;
    border-radius: 10px;
   }
 

   #all-users-section h2 {
    margin-bottom: 20px;
    text-align: center;
   }
 

   .user-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
   }
 

   .user-card {
    background-color: #B5FFE1;
    border-radius: 10px;
    padding: 15px;
    margin: 10px;
    width: 200px;
    text-align: center;
   }
 

   .user-card img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
   }
 

   .delete-button {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #4E878C;
    color: #B5FFE1;
    border: none;
    padding: 5px 8px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
   }
 

   .delete-button:hover {
    background-color: #00241B;
   }
 

   /* Delete Confirmation Modal */
   #delete-confirmation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 13;
   }
 

   #delete-confirmation-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #B5FFE1;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: 80%;
    max-width: 500px;
   }
 

   #delete-confirmation-content p {
    margin-bottom: 20px;
    color: #00241B;
   }
 

   #delete-confirmation-content button {
    background-color: #00241B;
    color: #B5FFE1;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin: 0 10px;
   }
 

   #delete-confirmation-content button:hover {
    background-color: #4E878C;
   }
  </style>
 </head>
 

 <body>
  <!-- Header -->
  <header id="header">
   <h1>ConnectSphere</h1>
  </header>
 

  <!-- Profile Section -->
  <section id="profile-section">
   <img id="profile-image" src="" alt="Profile Picture" onclick="openEditProfileModal()">
   <h2 id="profile-name"></h2>
   <p id="profile-bio"></p>
  </section>
 

  <!-- Create Profile Modal -->
  <div id="create-profile-modal">
   <div id="create-profile-modal-content">
    <h2>Create Your Profile</h2>
    <input type="text" id="create-name" placeholder="Enter your name">
    <textarea id="create-bio" placeholder="Enter your bio"></textarea>
    <input type="file" id="create-image" accept="image/*">
    <button onclick="createProfileAndRefresh()">Create Profile</button>
   </div>
  </div>
 

  <!-- Edit Profile Modal -->
  <div id="edit-profile-modal">
   <div id="edit-profile-modal-content">
    <span id="close-edit-modal" onclick="closeEditProfileModal()">X</span>
    <h2>Edit Profile</h2>
    <input type="text" id="edit-name" placeholder="Enter new name">
    <textarea id="edit-bio" placeholder="Enter new bio"></textarea>
    <input type="file" id="edit-image" accept="image/*">
    <button onclick="saveProfileChanges()">Save Changes</button>
   </div>
  </div>
 

  <!-- Post Form -->
  <section id="post-form">
   <textarea id="post-content" placeholder="What's on your mind?"></textarea>
   <input type="file" id="post-image" accept="image/*">
   <button onclick="createPost()">Post</button>
  </section>
 

  <!-- Posts Section -->
  <section id="posts-section">
   <!-- Posts will be dynamically added here -->
  </section>
 

  <!-- Delete Confirmation Modal -->
  <div id="delete-confirmation-modal">
   <div id="delete-confirmation-content">
    <p>Are you sure you want to delete this post?</p>
    <button onclick="deletePostConfirmed()">Yes, Delete</button>
    <button onclick="closeDeleteConfirmationModal()">Cancel</button>
   </div>
  </div>
 

  <!-- All Users Section -->
  <section id="all-users-section">
   <h2>All Users</h2>
   <div class="user-list" id="user-list">
    <!-- Users will be dynamically added here -->
   </div>
  </section>
 

  <script>
   const BIN_ID = "67be7b78e41b4d34e49c83e6"; // Your JSONBin ID
   const POST_BIN_ID = "67be7b9fad19ca34f8123f64";
   const API_KEY = "$2a$10$eZn8/FkTPCRAYSTre2wkOetYJdpezY8Q3oT/ZYeZdi.RQod0SNVIK"; // Your API Key
   const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
   const POST_JSONBIN_URL = `https://api.jsonbin.io/v3/b/${POST_BIN_ID}`;
   let posts = JSON.parse(localStorage.getItem('posts')) || [];
   let profileName = localStorage.getItem('profileName') || '';
   let profileImage = localStorage.getItem('profileImage') || 'default-profile-icon.png';
   let profileBio = localStorage.getItem('profileBio') || '';
   let hasProfile = localStorage.getItem('hasProfile') === 'true';
   const defaultProfileIcon = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png';
   let currentPostIndex = -1;
 

   // Function to load profile information
   async function loadProfile() {
    if (localStorage.getItem('hasProfile') === 'true') {
     hasProfile = true;
    } else {
     hasProfile = false
    }
    if (!hasProfile) {
     openCreateProfileModal();
     return;
    }
 

    document.getElementById('profile-name').innerText = profileName;
    document.getElementById('profile-image').src = profileImage === 'default-profile-icon.png' ?
     defaultProfileIcon : profileImage;
    document.getElementById('profile-bio').innerText = profileBio;
    document.getElementById('profile-section').style.display = 'flex';
    document.getElementById('posts-section').style.display = 'block';
    document.getElementById('post-form').style.display = 'block';
    fetchAllUsers()
    await fetchPosts();
 

   }
 

   function savePostsToLocalStorage() {
    localStorage.setItem('posts', JSON.stringify(posts));
   }
 

   async function saveProfileToLocalStorage(name, image, bio) {
    localStorage.setItem('profileName', name);
    localStorage.setItem('profileImage', image);
    localStorage.setItem('profileBio', bio);
    localStorage.setItem('hasProfile', 'true');
 

   }
 

   function openCreateProfileModal() {
    document.getElementById('create-profile-modal').style.display = 'block';
   }
 

   function closeCreateProfileModal() {
    document.getElementById('create-profile-modal').style.display = 'none';
   }
 

   function openEditProfileModal() {
    document.getElementById('edit-profile-modal').style.display = 'block';
    document.getElementById('edit-name').value = profileName;
    document.getElementById('edit-bio').value = profileBio;
   }
 

   function closeEditProfileModal() {
    document.getElementById('edit-profile-modal').style.display = 'none';
   }
 

   function openDeleteConfirmationModal(index) {
    currentPostIndex = index;
    document.getElementById('delete-confirmation-modal').style.display = 'block';
   }
 

   function closeDeleteConfirmationModal() {
    document.getElementById('delete-confirmation-modal').style.display = 'none';
    currentPostIndex = -1;
   }
 

   function deletePostConfirmed() {
    if (currentPostIndex === -1) return;
 

    posts.splice(currentPostIndex, 1);
    savePostsToLocalStorage();
    renderPosts();
    closeDeleteConfirmationModal();
   }
 

   async function createProfileAndRefresh() {
    const newName = document.getElementById('create-name').value;
    const newBio = document.getElementById('create-bio').value;
    const newImageFile = document.getElementById('create-image').files[0];
 

    if (newName.trim() === '') {
     alert('Name is required.');
     return;
    }
 

    let imageUrl = defaultProfileIcon;
    if (newImageFile) {
     const reader = new FileReader();
     reader.onloadend = async function() {
      profileName = newName;
      profileBio = newBio
      imageUrl = reader.result;
      await saveProfileToLocalStorage(newName, imageUrl, newBio)
      hasProfile = true
      localStorage.setItem('hasProfile', 'true');
      await createUserProfileOnJsonBin(newName, profileBio, imageUrl); // Use the create function here
      loadProfile();
      closeCreateProfileModal();
     }
     reader.readAsDataURL(newImageFile);
    } else {
      profileName = newName;
      profileBio = newBio
      imageUrl = defaultProfileIcon;
     await saveProfileToLocalStorage(newName, imageUrl, newBio)
      loadProfile();
      await createUserProfileOnJsonBin(newName, profileBio, imageUrl); // Use the create function here
      closeCreateProfileModal()
 

     }
 

   }
 

   async function saveProfileChanges() {
    const newName = document.getElementById('edit-name').value;
    const newBio = document.getElementById('edit-bio').value;
    const newImageFile = document.getElementById('edit-image').files[0];
 

    if (newName.trim() !== '') {
     profileName = newName;
    }
    if (newBio.trim() !== '') {
     profileBio = newBio;
    }
 

    let imageUrl = profileImage;
    if (newImageFile) {
     const reader = new FileReader();
     reader.onloadend = async function() {
      profileImage = reader.result;
      document.getElementById('profile-image').src = profileImage;
      document.getElementById('profile-name').innerText = profileName;
      document.getElementById('profile-bio').innerText = profileBio;
      await saveProfileToLocalStorage(newName, profileImage, newBio);
      await updateUserProfileOnJsonBin(newName, profileBio, imageUrl);
      closeEditProfileModal();
     }
     reader.readAsDataURL(newImageFile);
    } else {
     document.getElementById('profile-name').innerText = profileName;
     document.getElementById('profile-bio').innerText = profileBio;
     await saveProfileToLocalStorage(newName, profileImage, newBio);
      await updateUserProfileOnJsonBin(newName, profileBio, imageUrl);
     closeEditProfileModal();
    }
   }
 

   async function updateUserProfileOnJsonBin(name, bio, image) {
    try {
     // Fetch existing data
     const response = await fetch(JSONBIN_URL, {
      method: 'GET',
      headers: {
       'Content-Type': 'application/json',
       'X-Master-Key': API_KEY
      }
     });
 

     if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
     }
 

     const data = await response.json();
     let usersArray = data.record;
 

     // Ensure usersArray is an array
     if (!Array.isArray(usersArray)) {
      usersArray = []; // Initialize as an empty array if it's not
     }
 

     // Find if the user already exists
     const existingUserIndex = usersArray.findIndex(user => user.name === name);
 

     // If the user exists, update the profile; otherwise, add a new user
     if (existingUserIndex !== -1) {
      usersArray[existingUserIndex] = {
       ...usersArray[existingUserIndex], // Keep existing properties
       bio: bio,
       image: image
      };
     }
 

     // Save the updated array back to JsonBin
     const putResponse = await fetch(JSONBIN_URL, {
      method: 'PUT',
      headers: {
       'Content-Type': 'application/json',
       'X-Master-Key': API_KEY
      },
      body: JSON.stringify(usersArray)
     });
 

     if (!putResponse.ok) {
      throw new Error(`HTTP error! status: ${putResponse.status}`);
     }
 

     const putData = await putResponse.json();
     console.log('Profile updated on JsonBin:', putData);
    } catch (error) {
     console.error('Failed to update profile on JsonBin:', error);
    }
   }
 

   async function createUserProfileOnJsonBin(profileName, profileBio, profileImage) {
    try {
     // Fetch existing data
     let response = await fetch(JSONBIN_URL, {
      method: "GET",
      headers: {
       "X-Master-Key": API_KEY
      }
     });
     let data = await response.json();
     let usersArray = data.record;
     if (!Array.isArray(usersArray)) {
      usersArray = [];
     }
     const newUser = {
      id: Date.now(),
      name: profileName,
      bio: profileBio,
      image: profileImage
     };
     if (usersArray.some(user => user.name === profileName)) {
      console.log('User already exists:', profileName);
      return;
     }
     usersArray.push(newUser);
     await fetch(JSONBIN_URL, {
      method: "PUT",
      headers: {
       "Content-Type": "application/json",
       "X-Master-Key": API_KEY
      },
      body: JSON.stringify(usersArray)
     });
     console.log("User profile created:", newUser);
    } catch (error) {
     console.error("Error creating user profile:", error);
    }
   }
   async function createPost() {
    const postContent = document.getElementById('post-content').value;
    const postImage = document.getElementById('post-image').files[0];
 

    if (postContent.trim() === '' && !postImage) {
     alert('Please enter some text or select an image to post.');
     return;
    }
 

    let imageUrl = null;
    if (postImage) {
     const reader = new FileReader();
      reader.onloadend = async function() {
       imageUrl = reader.result;
       const newPost = {
        authorName: profileName,
        authorImage: profileImage,
        content: postContent,
        imageUrl: imageUrl,
        likes: 0,
        liked: false
       };
       await savePostToJSONBin(newPost); // Save the post to JSONBin
       posts.unshift(newPost);
       savePostsToLocalStorage();
       renderPosts();
       document.getElementById('post-content').value = '';
       document.getElementById('post-image').value = '';
      }
      reader.readAsDataURL(postImage);
    } else {
      const newPost = {
       authorName: profileName,
       authorImage: profileImage,
       content: postContent,
       imageUrl: null,
       likes: 0,
       liked: false
      };
      await savePostToJSONBin(newPost); // Save the post to JSONBin
      posts.unshift(newPost);
      savePostsToLocalStorage();
      renderPosts();
      document.getElementById('post-content').value = '';
      document.getElementById('post-image').value = '';
    }
   }
 

   async function savePostToJSONBin(newPost) {
    try {
     const response = await fetch(POST_JSONBIN_URL, {
      method: "GET",
      headers: {
       "X-Master-Key": API_KEY
      }
     });
     if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
     }
     const data = await response.json();
     let postsArray = data.record;
     if (!Array.isArray(postsArray)) {
      postsArray = [];
     }
     postsArray.push(newPost);
     await fetch(POST_JSONBIN_URL, {
      method: "PUT",
      headers: {
       "Content-Type": "application/json",
       "X-Master-Key": API_KEY
      },
      body: JSON.stringify(postsArray)
     });
     console.log("Post created:", newPost);
     fetchPosts();
    } catch (error) {
     console.error("Error creating post:", error);
    }
   }
 

   function toggleLike(index) {
    posts[index].liked = !posts[index].liked;
    posts[index].likes += posts[index].liked ? 1 : -1;
    savePostsToLocalStorage();
    renderPosts();
   }
 

   async function fetchPosts() {
    try {
     const response = await fetch(POST_JSONBIN_URL, {
      method: "GET",
      headers: {
       "X-Master-Key": API_KEY
      }
     });
     if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
     }
     const data = await response.json();
     posts = data.record || []; // Ensure posts is an array
     savePostsToLocalStorage();
     renderPosts();
    } catch (error) {
     console.error('Error fetching posts from JSONBin:', error);
    }
   }
 

   function renderPosts() {
    const postsSection = document.getElementById('posts-section');
    postsSection.innerHTML = '';
 

    posts.forEach((post, index) => {
     const postDiv = document.createElement('div');
     postDiv.classList.add('post');
 

     let imageHTML = '';
     if (post.imageUrl) {
      imageHTML = `<img src="${post.imageUrl}" alt="Post Image" style="border-radius: 5px; margin-bottom: 10px; max-width: 100%; height: auto;">`;
     }
 

     const likeButtonClass = post.liked ? 'like-button liked' : 'like-button';
 

     postDiv.innerHTML = `
                <div class="post-header">
                    <img class="post-author-image" src="${post.authorImage === 'default-profile-icon.png' ? defaultProfileIcon : post.authorImage}" alt="Author" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 10px;">
                    <span class="post-author-name" style="font-weight: bold; color: #00241B;">${post.authorName}</span>
                </div>
                ${imageHTML}
                <div class="post-content" style="color: #00241B; margin-bottom: 10px;">${post.content}</div>
                <div class="post-interactions" style="margin-top: 10px; display: flex; justify-content: space-around; align-items: center;">
                    <button class="${likeButtonClass}" onclick="toggleLike(${index})" style="background-color: #00241B; color: #B5FFE1; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease;">Like (${post.likes})</button>
                </div>
                <button class="delete-button" onclick="openDeleteConfirmationModal(${index})" style="position: absolute; top: 5px; right: 5px; background-color: #4E878C; color: #B5FFE1; border: none; padding: 5px 8px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease;">Delete</button>
            `;
 

     postsSection.appendChild(postDiv);
    });
   }
   async function fetchAllUsers() {
    try {
     const response = await fetch(JSONBIN_URL, {
      method: "GET",
      headers: {
       "X-Master-Key": API_KEY
      }
     });
     if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
     }
     const data = await response.json();
     let usersData = data.record;
     if (!Array.isArray(usersData)) {
      usersData = [];
     }
     const currentUser = {
      name: localStorage.getItem('profileName'),
      bio: localStorage.getItem('profileBio'),
      image: localStorage.getItem('profileImage')
     };
     const filteredUsers = usersData.filter(user => user.name !== currentUser.name);
     renderUsers(filteredUsers);
    } catch (error) {
     console.error('Failed to fetch users from JsonBin:', error);
    }
   }
 

   // Function to render user cards
   function renderUsers(users) {
    const userList = document.getElementById('user-list');
    userList.innerHTML = ''; // Clear existing content
 

    users.forEach(user => {
     const userCard = document.createElement('div');
     userCard.classList.add('user-card');
 

     userCard.innerHTML = `
                        <img src="${user.image}" alt="${user.name}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px;">
                        <h3>${user.name}</h3>
                        <p>${user.bio}</p>
                    `;
 

     userList.appendChild(userCard);
    });
   }
 

   loadProfile();
  </script>
 </body>
 

 </html>